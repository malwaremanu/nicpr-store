<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Stock and Inventory Management</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap" rel="stylesheet">
<style>
  body {
    font-family: "Inter", serif;
    font-optical-sizing: auto;
    font-weight: 400;
    font-style: normal;
  }

  [x-cloak] {
    display: none !important;
  }

  /* fallback */
  @font-face {
    font-family: 'Material Symbols Outlined';
    font-style: normal;
    font-weight: 100 700;
    src: url(https://fonts.gstatic.com/s/materialsymbolsoutlined/v222/kJEhBvYX7BgnkSrUwT8OhrdQw4oELdPIeeII9v6oFsLjBuVY.woff2) format('woff2');
  }

  .material-symbols-outlined {
    font-family: 'Material Symbols Outlined';
    font-weight: normal;
    font-style: normal;
    font-size: 24px;
    letter-spacing: normal;
    text-transform: none;
    display: inline-block;
    white-space: nowrap;
    word-wrap: normal;
    direction: ltr;
    -moz-font-feature-settings: 'liga';
    -moz-osx-font-smoothing: grayscale;
  }

  .loading {
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .loading img {
    width: 20px;
    height: 20px;
  }
</style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100">
  <div id="app">
    <section class="bg-gray-50 dark:bg-gray-800">
      <div class="flex flex-col items-center justify-center px-6 py-8 mx-auto md:h-screen lg:py-0">
        <a href="#" class="flex flex-col items-center mb-6 text-2xl font-semibold text-gray-900 dark:text-gray-100">
          <div><img class="h-14 mr-2" src="https://erp.nicpr.org/nicpr_logo.png" alt="logo"></div>
          <div>Stock and Inventory Management System</div>
        </a>
        <div class="w-full max-w-md bg-white dark:bg-gray-700 rounded-lg shadow-md p-8">
          <h1 class="text-xl font-bold leading-tight tracking-tight text-gray-900 dark:text-gray-100 md:text-2xl mb-6">
            Sign in to your account
          </h1>
          <form id="login-form">
            <label for="username" class="block mb-2 text-sm font-medium text-gray-700 dark:text-gray-300">Username</label>
            <input
              type="text"
              id="username"
              class="w-full px-3 py-2 border rounded-lg mb-4 bg-gray-50 dark:bg-gray-600 text-gray-900 dark:text-gray-100"
              placeholder="Enter your username"
              required
              aria-label="Username" />
            <label for="password" class="block mb-2 text-sm font-medium text-gray-700 dark:text-gray-300">Password</label>
            <input
              type="password"
              id="password"
              class="w-full px-3 py-2 border rounded-lg mb-4 bg-gray-50 dark:bg-gray-600 text-gray-900 dark:text-gray-100"
              placeholder="Enter your password"
              required
              aria-label="Password" />
            <input type="hidden" id="org_id" value="ef1aa2bc-da00-40a0-83fd-dae68b29de5b" />
            <button
              type="submit"
              id="login_btn"
              class="w-full bg-blue-500 text-white py-2 rounded-lg hover:bg-blue-600 flex items-center justify-center">
              Login
            </button>
          </form>
        </div>
        <button id="theme-toggle" class="mt-4 px-4 py-2 bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-100 rounded">
          Toggle Dark Mode
        </button>
      </div>
    </section>
  </div>

<script>
  const loginForm = document.getElementById('login-form');
  const loginButton = document.getElementById('login_btn');
  const themeToggle = document.getElementById('theme-toggle');
  const url = "/index.html";

  // Handle login
  loginForm.addEventListener('submit', async (event) => {
    event.preventDefault();
    const username = document.getElementById('username').value;
    const password = document.getElementById('password').value;
    const org_id = document.getElementById('org_id').value;

    loginButton.disabled = true;
    loginButton.innerHTML = '<div class="loading"><img src="https://i.gifer.com/origin/34/34338d26023e5515f6cc8969aa027bca_w200.gif" alt="Loading..."></div>';

    try {
      const response = await fetch('https://prod-api.manupal.dev/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ username, password, org_id }),
      });

      if (response.ok) {
        const data = await response.json();
        const authToken = data.access_token;

        window.localStorage.setItem("authToken", authToken);
        console.log("Login successful.");
        loginButton.innerText = "Logged in. Redirecting now";
        setTimeout(() => {
          location.href = url;
        }, 2000);
      } else {
        alert('Invalid credentials');
        loginButton.disabled = false;
        loginButton.innerText = "Login";
      }
    } catch (error) {
      alert('Error during login: ' + error.message);
      loginButton.disabled = false;
      loginButton.innerText = "Login";
    }
  });

  // Dark mode toggle
  const isDarkMode = localStorage.getItem('darkMode') === 'true';
  if (isDarkMode) {
    document.documentElement.classList.add('dark');
  } else {
    document.documentElement.classList.remove('dark');
  }

  themeToggle.addEventListener('click', () => {
    const isDark = document.documentElement.classList.toggle('dark');
    localStorage.setItem('darkMode', isDark);
  });
</script>
</body>
</html>