{% extends "base_user.html" %}

{% block user_content %}
<div class="mx-auto bg-white p-6 rounded shadow">
    <h2 class="text-2xl mb-4">Manage {{ entity|capitalize }}</h2>
    <form id="masterForm" class="grid grid-cols-3 gap-2">
        {% for field, details in schema.items.items() %}
        <div class="mb-4">
            <label for="{{ field }}" class="block text-gray-700">{{ details['description'] }}</label>
            {% if details['type'] == 'string' %}
                <input type="text" id="{{ field }}" name="{{ field }}" class="w-full px-3 py-2 border rounded" required>
            {% elif details['type'] == 'integer' %}
                <input type="number" id="{{ field }}" name="{{ field }}" class="w-full px-3 py-2 border rounded" required>
            {% elif details['type'] == 'array' %}
                <select id="{{ field }}" name="{{ field }}" class="w-full px-3 py-2 border rounded" required>
                    {% for option in details['enum'] %}
                    <option value="{{ option }}">{{ option|capitalize }}</option>
                    {% endfor %}
                </select>
            {% endif %}
        </div>
        {% endfor %}
        <div class="mb-4">
            <label for="" class="block text-gray-700">&nbsp;</label>
            <button type="button" onclick="submitForm('{{ url_for('master.crud', entity=entity) }}')" class="bg-blue-500 text-white px-4 py-2 rounded-full">Add Item</button>
        </div>
    </form>
</div>
<div class="mt-8">
    <h2 class="text-2xl mb-4">{{ entity|capitalize }} List</h2>
    <table class="min-w-full bg-white">
        <thead>
            <tr>
                {% for field in schema['items'].keys() %}
                <th class="py-2 px-4 border-b">{{ field|capitalize }}</th>
                {% endfor %}
                <th class="py-2 px-4 border-b">Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for item in items %}
            <tr>
                {% for field in schema['items'].keys() %}
                <td class="py-2 px-4 border-b">{{ item[field] }}</td>
                {% endfor %}
                <td class="py-2 px-4 border-b">
                    <a href="{{ url_for('master.crud_item', entity=entity, item_id=item[schema['properties'].keys()[0]]) }}" class="text-blue-500">Edit</a>
                    <button type="button" onclick="deleteItem('{{ url_for('master.crud_item', entity=entity, item_id=item[schema['properties'].keys()[0]]) }}')" class="text-red-500">Delete</button>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
<script>
function submitForm(url) {
    const form = document.getElementById('masterForm');
    const formData = new FormData(form);
    const data = {};
    formData.forEach((value, key) => {
        data[key] = value;
    });

    fetch(url, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(data)
    })
    .then(response => response.json())
    .then(data => {
        alert(data.message);
        location.reload();
    })
    .catch(error => console.error('Error:', error));
}

function deleteItem(url) {
    fetch(url, {
        method: 'DELETE'
    })
    .then(response => response.json())
    .then(data => {
        alert(data.message);
        location.reload();
    })
    .catch(error => console.error('Error:', error));
}
</script>
{% endblock %}